<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <!--Setting-->
    <meta name="baidu-site-verification" content="code-f6RfR7ByGN" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="XinAnXiaoZhan">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.3.0">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="https://nodisappear.github.io">
    <!--SEO-->

<meta name="keywords" content="笔记" />


<meta name="description" content="掘金小册——JavaScript 设计模式核心原理与应用实践
开篇：前端工程师的成长论一. 软件工程师的核心竞争力&ensp;驾驭技术的能力

能用健壮的代码解决具体问题
能用抽象的思维应对复杂..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    读《JavaScript设计模式核心原理与应用实践》 |
    
    XinAnXiaoZhan
</title>

<link rel="alternate" href="/atom.xml" title="XinAnXiaoZhan" type="application/atom+xml">


<link rel="icon" href="./img/page-favicon.jpg">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    



    

<meta name="generator" content="Hexo 5.4.1"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header">
    <div class="main-header-box">
        <div class="header-avatar">
            <img class="img-responsive center-block" src="/./img/head-avatar-2.jpg" alt="头像">
        </div>
        <div class="main-header-title">
            <span>不虚此行，好好欣赏旅途上的风景</span>
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                    <i class="fa fa-bars"></i>
                </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                           
                        <li role="presentation" class="text-center menus">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                           
                        <li role="presentation" class="text-center menus">
                            <a href="/categories/"><i class="fa "></i>
                                分类</a>
                        </li>
                           
                        <li role="presentation" class="text-center menus">
                            <a href="/tags/"><i class="fa "></i>
                                标签</a>
                        </li>
                           
                        <li role="presentation" class="text-center menus">
                            <a href="/archives/"><i class="fa "></i>
                                归档</a>
                        </li>
                           
                        <li role="presentation" class="text-center menus">
                            <a href="/about/"><i class="fa "></i>
                                关于</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-9 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="读《JavaScript设计模式核心原理与应用实践》">
            
            读《JavaScript设计模式核心原理与应用实践》
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-none-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2021/11/03</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p><a target="_blank" rel="noopener" href="https://juejin.cn/book/6844733790204461070">掘金小册——JavaScript 设计模式核心原理与应用实践</a></p>
<h2 id="开篇：前端工程师的成长论"><a href="#开篇：前端工程师的成长论" class="headerlink" title="开篇：前端工程师的成长论"></a>开篇：前端工程师的成长论</h2><h3 id="一-软件工程师的核心竞争力"><a href="#一-软件工程师的核心竞争力" class="headerlink" title="一. 软件工程师的核心竞争力"></a>一. 软件工程师的核心竞争力</h3><p>&ensp;<strong>驾驭技术的能力</strong></p>
<ol>
<li>能用健壮的代码解决具体问题</li>
<li>能用抽象的思维应对复杂系统</li>
<li>能用工程化思想规划大型业务</li>
</ol>
<h2 id="设计模式的“道”与“术”"><a href="#设计模式的“道”与“术”" class="headerlink" title="设计模式的“道”与“术”"></a>设计模式的“道”与“术”</h2><h3 id="一-设计模式的指导理论"><a href="#一-设计模式的指导理论" class="headerlink" title="一. 设计模式的指导理论"></a>一. 设计模式的指导理论</h3><p>&ensp;<strong>SOLID 设计原则</strong></p>
<ol>
<li>*单一职责 [单一功能]</li>
<li>*开放封闭 —— 对扩展开放，对修改封闭<ul>
<li>类、模块、函数等软件实体可以扩展，但不可以修改</li>
</ul>
</li>
<li>李式置换 [里式替换]</li>
<li>接口独立 [接口隔离]</li>
<li>依赖导致 [依赖反转]</li>
</ol>
<h3 id="二-设计模式的核心思想"><a href="#二-设计模式的核心思想" class="headerlink" title="二. 设计模式的核心思想"></a>二. 设计模式的核心思想</h3><p>&ensp;<strong>封装变化</strong></p>
<p>&ensp;观察整个逻辑里面的变与不变并分离它们，使变化的部分灵活而不变的部分稳定</p>
<h3 id="三-23-种设计模式"><a href="#三-23-种设计模式" class="headerlink" title="三. 23 种设计模式"></a>三. 23 种设计模式</h3><p>&ensp;<strong>创建型 —— 封装创建对象过程中的变化</strong></p>
<ol>
<li>单例模式</li>
<li>原型模式</li>
<li>构造器模式</li>
<li>工厂模式</li>
<li>抽象工厂模式</li>
</ol>
<p>&ensp;<strong>结构型 —— 封装对象之间组合方式的变化</strong></p>
<ol>
<li>桥接模式</li>
<li>外观模式</li>
<li>组合模式</li>
<li>装饰器模式</li>
<li>适配器模式</li>
<li>代理模式</li>
<li>享元模式</li>
</ol>
<p>&ensp;<strong>行为型 —— 封装对象千变万化的行为</strong></p>
<ol>
<li>迭代器模式</li>
<li>解释器模式</li>
<li>观察者模式</li>
<li>中介者模式</li>
<li>访问者模式</li>
<li>状态模式</li>
<li>备忘录模式</li>
<li>策略模式</li>
<li>模板方法模式</li>
<li>职责链模式</li>
<li>命令模式</li>
</ol>
<h2 id="创建型：工厂模式-——-区分“变与不变”"><a href="#创建型：工厂模式-——-区分“变与不变”" class="headerlink" title="创建型：工厂模式 —— 区分“变与不变”"></a>创建型：工厂模式 —— 区分“变与不变”</h2><h3 id="一-构造器模式"><a href="#一-构造器模式" class="headerlink" title="一. 构造器模式"></a>一. 构造器模式</h3><p>&ensp;<strong>用构造函数初始化对象 —— 抽象不同对象实例之间的变与不变</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将赋值过程封装，确保每个对象具备 共性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name, age, career</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">career</span> = career;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将取值操作开放，确保每个对象具备 个性</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李雷&quot;</span>, <span class="number">25</span>, <span class="string">&quot;coder&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="二-简单工厂模式"><a href="#二-简单工厂模式" class="headerlink" title="二. 简单工厂模式"></a>二. 简单工厂模式</h3><p>&ensp;<strong>将创建对象的过程单独封装 —— 抽象不同构造函数之间的变与不变</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">name, age, career, work</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">career</span> = career;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">work</span> = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 承载共性的构造函数 和 承载个性的逻辑判断 写入同一函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Factory</span>(<span class="params">name, age, career</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> work;</span><br><span class="line">  <span class="keyword">switch</span> (career) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;boss&quot;</span>:</span><br><span class="line">      work = [<span class="string">&quot;喝茶&quot;</span>, <span class="string">&quot;看报&quot;</span>, <span class="string">&quot;见客户&quot;</span>];</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;coder&quot;</span>:</span><br><span class="line">      work = [<span class="string">&quot;写代码&quot;</span>, <span class="string">&quot;写系分&quot;</span>, <span class="string">&quot;修Bug&quot;</span>];</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;李雷&quot;</span>, <span class="number">25</span>, <span class="string">&quot;coder&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&ensp;<strong><code>重要提示：</code></strong><br>&emsp;在写了大量构造函数、调用了大量 new 的情况下，就应该思考是不是可以用工厂模式重构代码了！</p>
<h3 id="三-抽象工厂模式"><a href="#三-抽象工厂模式" class="headerlink" title="三. 抽象工厂模式"></a>三. 抽象工厂模式</h3><p>&ensp;<strong>围绕一个超级工厂创建其他工厂 —— 遵循“开放封闭”设计原则</strong></p>
<p>&ensp;将一个复杂场景中不同的类按性质划分为 4 个关键角色[1 - 4]：</p>
<p>&nbsp;0. 超级工厂：拥有多个抽象工厂的系统 【电子厂】</p>
<ol>
<li>抽象工厂：抽象类，用于声明最终目标产品的共性，每个抽象工厂对应的一类产品称为“产品族” 【手机厂，电脑厂，…】</li>
<li>具体工厂：继承自抽象工厂，用于生成产品族里的一类具体产品 【智能手机厂，非智能手机厂，…】</li>
<li>抽象产品：抽象类，用于声明具体产品所依赖的细粒度产品的共性 【操作系统厂，硬件厂，…】</li>
<li>具体产品： 继承自抽象产品，用于生成具体产品所依赖的细粒度产品 【安卓操作系统厂/苹果操作系统厂，小米硬件厂/高通硬件厂，…】</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂，定义手机的共性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MobilePhoneFactory</span> &#123;</span><br><span class="line">  <span class="title function_">createOS</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 提供操作系统的接口</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象工厂方法不允许直接调用，你需要将我重写！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createHardWare</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 提供硬件的接口</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象工厂方法不允许直接调用，你需要将我重写！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体工厂，用于生成手机实例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FakeStarFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">MobilePhoneFactory</span> &#123;</span><br><span class="line">  <span class="title function_">createOS</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 提供操作系统实例</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidOS</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createHardWare</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 提供硬件实例</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">QualcommHardWare</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象产品，定义手机操作系统的共性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OS</span> &#123;</span><br><span class="line">  <span class="title function_">controlHardWare</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象产品方法不允许直接调用，你需要将我重写！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体产品，定义具体的手机操作系统</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndroidOS</span> <span class="keyword">extends</span> <span class="title class_ inherited__">OS</span> &#123;</span><br><span class="line">  <span class="title function_">controlHardWare</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;操作系统：我会用安卓的方式去操作硬件&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 抽象产品，定义手机硬件的共性</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HardWare</span> &#123;</span><br><span class="line">  <span class="title function_">operateByOrder</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象产品方法不允许直接调用，你需要将我重写！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体产品：定义具体的手机硬件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QualcommHardWare</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HardWare</span> &#123;</span><br><span class="line">  <span class="title function_">operateByOrder</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;硬件：我会用高通的方式去运转&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产一台拥有安卓操作系统和高通硬件的手机</span></span><br><span class="line"><span class="keyword">const</span> myMobilePhone = <span class="keyword">new</span> <span class="title class_">FakeStarFactory</span>(); <span class="comment">// 创建手机实例</span></span><br><span class="line"><span class="keyword">const</span> myOS = myMobilePhone.<span class="title function_">createOS</span>(); <span class="comment">// 添加操作系统</span></span><br><span class="line"><span class="keyword">const</span> myHardWare = myMobilePhone.<span class="title function_">createHardWare</span>(); <span class="comment">// 添加硬件</span></span><br><span class="line">myOS.<span class="title function_">controlHardWare</span>(); <span class="comment">// 启动操作系统</span></span><br><span class="line">myHardWare.<span class="title function_">operateByOrder</span>(); <span class="comment">// 启动硬件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展具体工厂， 生产一款新的手机</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">newStarFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">MobilePhoneFactory</span> &#123;</span><br><span class="line">  <span class="title function_">createOS</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">createHardWare</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&ensp;<strong><code>重要提示：</code></strong><br>&emsp;1. 抽象工厂和简单工厂的共同之处是都基于“封装变化”的思想去分离一个系统中变与不变的部分，不同之处是应用的场景复杂度不同，简单工厂的处理对象是不苛求可扩展性的简单类，抽象工厂的处理对象是存在各种扩展可能性的能进一步划分的复杂类。<br>&emsp;2. 抽象工厂目前在 JS 中应用得并不广泛，需要留意三点：(1) 学会用 ES6 模拟 Java 中的抽象类；(2) 了解抽象工厂模式中四个角色的定位和作用；(3) 理解“开放封闭”设计原则，知道它的好用之处和执行之必要性。</p>
<h2 id="创建型：单例模式-——-Vuex-的数据管理哲学"><a href="#创建型：单例模式-——-Vuex-的数据管理哲学" class="headerlink" title="创建型：单例模式 —— Vuex 的数据管理哲学"></a>创建型：单例模式 —— Vuex 的数据管理哲学</h2><h3 id="一-单例模式的实现思路"><a href="#一-单例模式的实现思路" class="headerlink" title="一. 单例模式的实现思路"></a>一. 单例模式的实现思路</h3><p>&ensp;<strong>保证一个类仅有一个实例，并提供一个访问它的全局访问点 —— 不管尝试创建多少次，都只返回第一次创建的实例</strong></p>
<p>&ensp;构造函数需要具备判断自己是否已经创建过一个实例的能力</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.判断逻辑写在静态方法中</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleDog</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">instance</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span> = <span class="keyword">new</span> <span class="title class_">SingleDog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">instance</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> s1 = <span class="title class_">SingleDog</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">SingleDog</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.判断逻辑写在闭包中</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SingleDog</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> getInstance = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      instance = <span class="keyword">new</span> <span class="title class_">SingleDog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">const</span> s1 = <span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title function_">getInstance</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// s1和s2都指向唯一的实例</span></span><br><span class="line">s1 === s2; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="二-生产实践：Vuex-中的单例模式"><a href="#二-生产实践：Vuex-中的单例模式" class="headerlink" title="二. 生产实践：Vuex 中的单例模式"></a>二. 生产实践：Vuex 中的单例模式</h3><p><strong>理解 Vuex 中的 Store</strong></p>
<ol>
<li>引入 Vuex 插件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Vue.use 源码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 截取参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toArray</span>(<span class="params">list: any, start?: number</span>): <span class="title class_">Array</span>&lt;any&gt; &#123;</span><br><span class="line">  start = start || <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> i = list.<span class="property">length</span> - start;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">ret</span>: <span class="title class_">Array</span>&lt;any&gt; = <span class="keyword">new</span> <span class="title class_">Array</span>(i);</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    ret[i] = list[i + start];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注册插件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initUse</span>(<span class="params">Vue: GlobalAPI</span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">use</span> = <span class="keyword">function</span> (<span class="params">plugin: <span class="built_in">Function</span> | <span class="built_in">Object</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> installedPlugins =</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">_installedPlugins</span> || (<span class="variable language_">this</span>.<span class="property">_installedPlugins</span> = []); <span class="comment">// 已安装插件列表</span></span><br><span class="line">    <span class="keyword">if</span> (installedPlugins.<span class="title function_">indexOf</span>(plugin) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 防止重复注册</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> args = <span class="title function_">toArray</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    args.<span class="title function_">unshift</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin.<span class="property">install</span> === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果插件是一个对象，必须提供install方法</span></span><br><span class="line">      plugin.<span class="property">install</span>.<span class="title function_">apply</span>(plugin, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果插件是一个函数，它会被直接当作install方法</span></span><br><span class="line">      plugin.<span class="title function_">apply</span>(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">    installedPlugins.<span class="title function_">push</span>(plugin);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Vuex install 源码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vue; <span class="comment">// instance</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">_Vue</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Vue</span> &amp;&amp; _Vue === <span class="title class_">Vue</span>) &#123;</span><br><span class="line">    <span class="comment">// 判断传入的Vue实例对象是否已经被install过Vuex插件</span></span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(</span><br><span class="line">        <span class="string">&quot;[vuex] already installed. Vue.use(Vuex) should be called only once.&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Vue</span> = _Vue; <span class="comment">// 若没有，为该Vue实例对象install一个唯一的Vuex</span></span><br><span class="line">  <span class="title function_">applyMixin</span>(<span class="title class_">Vue</span>); <span class="comment">// 将Vuex的初始化逻辑写进Vue的钩子函数里</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// applyMixin(Vue)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">vuexInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> options = <span class="variable language_">this</span>.<span class="property">$options</span>; <span class="comment">// 当前Vue实例的初始化选项</span></span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">store</span>) &#123;</span><br><span class="line">    <span class="comment">// 根实例有store</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span> =</span><br><span class="line">      <span class="keyword">typeof</span> options.<span class="property">store</span> === <span class="string">&quot;function&quot;</span> ? options.<span class="title function_">store</span>() : options.<span class="property">store</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">parent</span> &amp;&amp; options.<span class="property">parent</span>.<span class="property">$store</span>) &#123;</span><br><span class="line">    <span class="comment">// 根实例没有store，就找父节点的store</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span> = options.<span class="property">parent</span>.<span class="property">$store</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123; <span class="attr">beforeCreate</span>: vuexInit &#125;); <span class="comment">// 全局混入</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建 store</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>将 store 注入到 Vue 实例中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  store,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="创建型：原型模式-——-谈-Prototype-无小事"><a href="#创建型：原型模式-——-谈-Prototype-无小事" class="headerlink" title="创建型：原型模式 —— 谈 Prototype 无小事"></a>创建型：原型模式 —— 谈 Prototype 无小事</h2><h3 id="一-以类为中心的语言和以原型为中心的语言"><a href="#一-以类为中心的语言和以原型为中心的语言" class="headerlink" title="一. 以类为中心的语言和以原型为中心的语言"></a>一. 以类为中心的语言和以原型为中心的语言</h3><p>&ensp;<strong>以类为中心的语言，原型模式不是必选项，它只用于特定场景</strong> </p>
<p>&ensp;Java在大多数情况下以“实例化类”的方式来创建对象，虽然专门针对原型模式设计了一套接口和方法，但是只在必要场景下通过原型方法来应用原型模式，实现类型之间的解耦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化类：通过传递相同的参数来创建相同的实例</span></span><br><span class="line"><span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;旺财&#x27;</span>, <span class="string">&#x27;male&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;柴犬&#x27;</span>)</span><br><span class="line"><span class="type">Dog</span> <span class="variable">dog_copy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;旺财&#x27;</span>, <span class="string">&#x27;male&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;柴犬&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>&ensp;<strong>以原型为中心的语言，原型模式是根基，是一种编程范式</strong> </p>
<p>&ensp;JavaScript本身类型比较模糊，不存在类型耦合的问题，使用原型模式不是为了得到一个副本，而是为了得到与构造函数（类）相对应类型的实例，实现数据和方法的共享</p>
<h3 id="二-谈原型模式，其实是谈原型范式"><a href="#二-谈原型模式，其实是谈原型范式" class="headerlink" title="二. 谈原型模式，其实是谈原型范式"></a>二. 谈原型模式，其实是谈原型范式</h3><p>&ensp;<strong>在JavaScript中，原型编程范式的体现就是基于原型链的继承</strong></p>
<h4 id="1-原型"><a href="#1-原型" class="headerlink" title="1. 原型"></a>1. 原型</h4><p>&ensp;(1) 每个构造函数都有一个prototype属性指向其原型对象，而其原型对象又有一个constructor属性指回构造函数本身<br>&ensp;(2) 每个实例都有一个__proto__属性，使用构造函数创建实例时，实例的__proto__属性就会指向构造函数的原型对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Dog构造函数</span></span><br><span class="line"><span class="comment">// Dog.prototype.constructor === Dog</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;肉骨头真好吃&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Dog构造函数创建dog实例</span></span><br><span class="line"><span class="comment">// dog.__proto__ === Dog.prototype</span></span><br><span class="line"><span class="comment">// dog.hasOwnProperty(&#x27;name&#x27;) === true; dog.hasOwnProperty(&#x27;age&#x27;) === true</span></span><br><span class="line"><span class="comment">// dog.eat === Dog.prototype.eat; dog.hasOwnProperty(&#x27;eat&#x27;) === false</span></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">Dog</span>(<span class="string">&#x27;旺财&#x27;</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原型链： 实例 -&gt; 实例的原型对象 -&gt; 实例的原型对象的原型对象 ... -&gt; Object</span></span><br><span class="line"><span class="comment">// dog -&gt; dog.__proto__(Dog.prototype) -&gt;  Dog.prototype.__proto__(Object.prototype)</span></span><br><span class="line"><span class="comment">// Object.prototype.__proto__ === null</span></span><br><span class="line">dog.<span class="title function_">toString</span>() === <span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个没有原型的对象</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>).<span class="property">__proto__</span> === <span class="literal">undefined</span></span><br></pre></td></tr></table></figure>

<h3 id="对象的深拷贝"><a href="#对象的深拷贝" class="headerlink" title="对象的深拷贝"></a>对象的深拷贝</h3><p>&ensp;<strong>深拷贝没有完美方案，每一种方案都有它的边界case，需要考虑不同数据结构（Array、Object、Map和Set等）的处理</strong></p>
<p>用递归实现深拷贝的核心思路</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">// 值类型或null</span></span><br><span class="line">    <span class="keyword">if</span>(obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义结果对象</span></span><br><span class="line">    <span class="keyword">let</span> copy = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(obj.<span class="property">constructor</span> === <span class="title class_">Array</span>) &#123;</span><br><span class="line">        copy = []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            copy[key] = <span class="title function_">deepClone</span>(obj[key])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> copy</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多内容： <a href="https://nodisappear.github.io/ad2c1b4b.html">深浅拷贝</a></p>
<h2 id="结构型：装饰器模式-——-对象装上它，就像开了挂"><a href="#结构型：装饰器模式-——-对象装上它，就像开了挂" class="headerlink" title="结构型：装饰器模式 —— 对象装上它，就像开了挂"></a>结构型：装饰器模式 —— 对象装上它，就像开了挂</h2><p>&ensp;<strong>在不改变原对象的基础上，对原对象进行包装拓展使其可以满足用户更复杂的需求</strong></p>
<h3 id="装饰器模式初相见"><a href="#装饰器模式初相见" class="headerlink" title="装饰器模式初相见"></a>装饰器模式初相见</h3><p>&ensp;<strong>为了不被业务逻辑所干扰，应该将旧逻辑与新逻辑分离</strong>  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- button --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&#x27;open&#x27;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modal</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Modal</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> modal = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!modal) &#123;</span><br><span class="line">            modal = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">            modal.<span class="property">innerText</span> = <span class="string">&#x27;modal&#x27;</span></span><br><span class="line">            modal.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(modal)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> modal</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="comment">// 封装旧逻辑-显示modal</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenButton</span> &#123;</span><br><span class="line">    <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> modal = <span class="keyword">new</span> <span class="title class_">Modal</span>()</span><br><span class="line">        modal.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 装饰器-修改按钮的文字和状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Decorator</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">open_button</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">open_button</span> = open_button <span class="comment">// 传入内含旧逻辑的实例</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">open_button</span>.<span class="title function_">onClick</span>() <span class="comment">// 执行-旧逻辑</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">changeButtonStatus</span>() <span class="comment">// 执行-新逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 整合新逻辑</span></span><br><span class="line">    <span class="title function_">changeButtonStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">changeButtonText</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">disableButton</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 拆分新逻辑</span></span><br><span class="line">    <span class="title function_">disableButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> btn =  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;open&#x27;</span>)</span><br><span class="line">        btn.<span class="title function_">setAttribute</span>(<span class="string">&quot;disabled&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">changeButtonText</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> btn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;open&#x27;</span>)</span><br><span class="line">        btn.<span class="property">innerText</span> = <span class="string">&#x27;置灰&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> openButton = <span class="keyword">new</span> <span class="title class_">OpenButton</span>()</span><br><span class="line"><span class="keyword">const</span> decorator = <span class="keyword">new</span> <span class="title class_">Decorator</span>(openButton)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;open&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    decorator.<span class="title function_">onClick</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="值得关注的细节"><a href="#值得关注的细节" class="headerlink" title="值得关注的细节"></a>值得关注的细节</h3><p>&ensp;<strong><code>重要提示：</code></strong><br>&emsp;在日常开发中，当遇到两段各司其职的代码逻辑时，首先要有“尝试拆分”的敏感，其次要有“该不该拆”的判断，当逻辑粒度过小时，盲目拆分会导致代码中存在过多零碎的小方法，反而不会使代码变得更好</p>
<h2 id="结构型：装饰器模式-——-深入装饰器原理与优秀案例"><a href="#结构型：装饰器模式-——-深入装饰器原理与优秀案例" class="headerlink" title="结构型：装饰器模式 —— 深入装饰器原理与优秀案例"></a>结构型：装饰器模式 —— 深入装饰器原理与优秀案例</h2><h3 id="前置知识：ES7中的装饰器"><a href="#前置知识：ES7中的装饰器" class="headerlink" title="前置知识：ES7中的装饰器"></a>前置知识：ES7中的装饰器</h3><p>&ensp;<strong>在ES7中，可以用 @语法糖 去装饰一个类或一个类的方法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装饰器函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">classDecorator</span>(<span class="params">target</span>) &#123;</span><br><span class="line">    target.<span class="property">hasDecorator</span> = <span class="literal">true</span> </span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 类装饰器</span></span><br><span class="line">@classDecorator</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> &#123;&#125; </span><br><span class="line"><span class="title class_">Button</span>.<span class="property">hasDecorator</span> <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">funDecorator</span>(<span class="params">target, name, descriptor</span>) &#123; </span><br><span class="line">    <span class="keyword">let</span> originalMethod = descriptor.<span class="property">value</span> </span><br><span class="line">    descriptor.<span class="property">value</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;装饰器逻辑&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> originalMethod.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> descriptor</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法装饰器</span></span><br><span class="line"><span class="title class_">Class</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    @funDecorator</span><br><span class="line">    <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原有逻辑&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">const</span> button = <span class="keyword">new</span> <span class="title class_">Button</span>() </span><br><span class="line">button.<span class="title function_">onClick</span>() <span class="comment">// 装饰器逻辑 原有逻辑</span></span><br></pre></td></tr></table></figure>

<h3 id="装饰器语法糖背后的故事"><a href="#装饰器语法糖背后的故事" class="headerlink" title="装饰器语法糖背后的故事"></a>装饰器语法糖背后的故事</h3><p>&ensp;<strong>装饰器最基本的操作是定义装饰器函数，将被装饰者“交给”装饰器</strong> </p>
<ol>
<li>装饰器函数传参<br>(1) 类修饰器：第一个参数是目标类<br>(2) 方法装饰器：第一个参数是目标类的原型对象，第二个参数是目标属性名，第三个参数是属性描述对象</li>
<li>装饰器函数的调用时机<br>装饰器函数在编译阶段执行，类的实例在代码运行时动态生成，为了让实例能正常调用被装饰好的类的方法，只能用装饰器去修饰目标类的原型对象</li>
</ol>
<h3 id="生产实践"><a href="#生产实践" class="headerlink" title="生产实践"></a>生产实践</h3><h4 id="React中的装饰器：HOC"><a href="#React中的装饰器：HOC" class="headerlink" title="React中的装饰器：HOC"></a>React中的装饰器：HOC</h4><p>&ensp;<strong>HOC（Higher Order Component），高阶组件</strong></p>
<ol>
<li>编写一个高阶组件，把传入的组件丢进一个有红色边框的容器中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 高阶组件是一个函数，接收一个组件作为参数，并返回一个新组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">BorderHoc</span> = <span class="title class_">WrappedComponent</span> =&gt; <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;&#123;&#123; border: &#x27;solid 1px red&#x27; &#125;&#125;&quot;</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">WrappedComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰目标组件</span></span><br><span class="line">@<span class="title class_">BorderHoc</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TargetComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>用装饰器改写 Redux connect</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> action <span class="keyword">from</span> <span class="string">&#x27;./action.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立组件和状态之间的映射关系</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">app</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建立组件和store.dispatch的关系，使组件具备通过dispatch来派发状态的能力</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapDispatchToProps</span>(<span class="params">dispatch</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">bindActionCreators</span>(action, dispatch)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------ 原本 ------- */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用connect可以返回一个具有装饰作用的函数，接收一个组件作为参数，传入组件与Redux结合，具备Redux提供的数据和能力</span></span><br><span class="line"><span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">App</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------ 改写 ------ */</span></span><br><span class="line"><span class="comment">// 将调用connect的结果作为一个装饰器</span></span><br><span class="line"><span class="keyword">const</span> _connect = <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)</span><br><span class="line"></span><br><span class="line">@_connect </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结构型：适配器模式-——-兼容代码就是一把梭"><a href="#结构型：适配器模式-——-兼容代码就是一把梭" class="headerlink" title="结构型：适配器模式 —— 兼容代码就是一把梭"></a>结构型：适配器模式 —— 兼容代码就是一把梭</h2><p>&ensp;<strong>通过把一个类的接口变换成客户端所期待的另一种接口，解决一些兼容性问题</strong></p>
<h3 id="适配器的业务场景"><a href="#适配器的业务场景" class="headerlink" title="适配器的业务场景"></a>适配器的业务场景</h3><p>&ensp;<strong>用适配器承接旧接口的参数，实现新旧接口的无缝衔接</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 旧接口</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Ajax</span>(<span class="params">type, url, data, success, failed</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(type === <span class="string">&#x27;Get&#x27;</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(type === <span class="string">&#x27;Post&#x27;</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Ajax</span>(<span class="string">&#x27;get&#x27;</span>, url, data, <span class="keyword">function</span>(<span class="params">res</span>)&#123;&#125;, <span class="keyword">function</span>(<span class="params">err</span>)&#123;&#125;)</span><br><span class="line"><span class="title class_">Ajax</span>(<span class="string">&#x27;post&#x27;</span>, url, data, <span class="keyword">function</span>(<span class="params">res</span>)&#123;&#125;, <span class="keyword">function</span>(<span class="params">err</span>)&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">get</span>(<span class="params">url</span>) &#123;&#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">post</span>(<span class="params">url, data</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器 - 入参与旧接口保持一致</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AjaxAdapter</span>(<span class="params">type, url, data, success, failed</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(type === <span class="string">&#x27;Get&#x27;</span>) &#123;</span><br><span class="line">            res = <span class="title class_">HttpUtils</span>.<span class="title function_">get</span>(url)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(type === <span class="string">&#x27;Post&#x27;</span>) &#123;</span><br><span class="line">            res = <span class="title class_">HttpUtils</span>.<span class="title function_">post</span>(url, data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">success</span>(res)</span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">        <span class="title function_">failed</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Ajax</span>(<span class="params">type, url, data, success, failed</span>) &#123;</span><br><span class="line">    <span class="title class_">AjaxAdapter</span>(type, url, data, success, failed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生产实践：axios中的适配器"><a href="#生产实践：axios中的适配器" class="headerlink" title="生产实践：axios中的适配器"></a>生产实践：axios中的适配器</h3><p>&ensp;<strong>用dispatchRequest方法派发请求</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 统一接口</span></span><br><span class="line"><span class="title class_">Axios</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">request</span> = <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">dispatchRequest</span>(newConfig) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用getDefaultAdapter方法获取默认适配器</span></span><br><span class="line"><span class="keyword">var</span> defaults = &#123;</span><br><span class="line">    <span class="attr">adapter</span>: <span class="title function_">getDefaultAdapter</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDefaultAdapter</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="keyword">var</span> adapter;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">XMLHttpRequest</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123; <span class="comment">// 浏览器环境</span></span><br><span class="line">        adapter = <span class="keyword">function</span> <span class="title function_">xhrAdapter</span>(<span class="params">config</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> <span class="title function_">dispatchXhrRequest</span>(<span class="params">resolve, reject</span>) &#123;&#125;) <span class="comment">// 4. 统一规则</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> process !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(process) === <span class="string">&#x27;[object process]&#x27;</span>) &#123; <span class="comment">// Node环境</span></span><br><span class="line">        adapter = <span class="keyword">function</span> <span class="title function_">httpAdapter</span>(<span class="params">config</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> <span class="title function_">dispatchHttpRequest</span>(<span class="params">resolvePromise, rejectPromise</span>) &#123;&#125; <span class="comment">// 4. 统一规则</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> adapter; <span class="comment">// 3. 统一出参，都是Promise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 统一入参，调用适配器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dispatchRequest</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// 转换请求体</span></span><br><span class="line">    config.<span class="property">data</span> = transformData.<span class="title function_">call</span>(</span><br><span class="line">        config,</span><br><span class="line">        config.<span class="property">data</span>,</span><br><span class="line">        config.<span class="property">headers</span>,</span><br><span class="line">        config.<span class="property">transformRequest</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">var</span> adapter = config.<span class="property">adapter</span> || defaults.<span class="property">adapter</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">adapter</span>(config).<span class="title function_">then</span>(</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">onAdapterResolution</span>(<span class="params">response</span>) &#123;</span><br><span class="line">            <span class="comment">// 转换响应体</span></span><br><span class="line">            response.<span class="property">data</span> = transformData.<span class="title function_">call</span>(</span><br><span class="line">                config,</span><br><span class="line">                response.<span class="property">data</span>,</span><br><span class="line">                response.<span class="property">headers</span>,</span><br><span class="line">                config.<span class="property">transformResponse</span></span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        &#125;, </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">onAdapterRejection</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="comment">// 转换响应体</span></span><br><span class="line">            <span class="keyword">if</span> (reason &amp;&amp; reason.<span class="property">response</span>) &#123;</span><br><span class="line">                reason.<span class="property">response</span>.<span class="property">data</span> = transformData.<span class="title function_">call</span>(</span><br><span class="line">                    config,</span><br><span class="line">                    reason.<span class="property">response</span>.<span class="property">data</span>,</span><br><span class="line">                    reason.<span class="property">response</span>.<span class="property">headers</span>,</span><br><span class="line">                    config.<span class="property">transformResponse</span></span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(reason)</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结构型：代理模式-——-应用实践范例解析"><a href="#结构型：代理模式-——-应用实践范例解析" class="headerlink" title="结构型：代理模式 —— 应用实践范例解析"></a>结构型：代理模式 —— 应用实践范例解析</h2><p>&ensp;<strong>一个对象不能直接访问另一个对象，需要第三者牵线搭桥而间接达到访问目的</strong></p>
<h3 id="前置知识-ES6中的Proxy"><a href="#前置知识-ES6中的Proxy" class="headerlink" title="前置知识 ES6中的Proxy"></a>前置知识 ES6中的Proxy</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, handler) <span class="comment">// target为目标对象，handler为拦截行为</span></span><br></pre></td></tr></table></figure>

<h3 id="事件代理"><a href="#事件代理" class="headerlink" title="事件代理"></a>事件代理</h3><p>&ensp;<strong>基于事件冒泡特性，将子元素的事件监听绑定到父元素上，操作不会直接触及目标子元素，而是由父元素进行处理分发后间接作用于子元素</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>链接1号<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>链接2号<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未代理，监听每个子元素</span></span><br><span class="line"><span class="keyword">const</span> aNodes = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;father&#x27;</span>).<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;aNodes.<span class="property">length</span>;i++) &#123;</span><br><span class="line">    aNodes[i].<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        e.<span class="title function_">preventDefault</span>()</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`我是<span class="subst">$&#123;aNodes[i].innerText&#125;</span>`</span>)                  </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 代理，只监听父元素</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;father&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(e.<span class="property">target</span>.<span class="property">tagName</span> === <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">        e.<span class="title function_">preventDefault</span>()</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">`我是<span class="subst">$&#123;e.target.innerText&#125;</span>`</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="虚拟代理"><a href="#虚拟代理" class="headerlink" title="虚拟代理"></a>虚拟代理</h3><p>&ensp;<strong>图片预加载时，页面img元素先展示占位图片，创建一个Image实例加载目标图片，然后将页面img元素的src指向目标图片（已缓存）</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 操作真实Image</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PreLoadImage</span> &#123; </span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">imgNode</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">imgNode</span> = imgNode</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setSrc</span>(<span class="params">imgUrl</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">imgNode</span>.<span class="property">src</span> = imgUrl</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收真实Image，操作虚拟Image</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyImage</span> &#123; </span><br><span class="line">    <span class="keyword">static</span> <span class="variable constant_">LOADING_URL</span> = <span class="string">&#x27;xxxxxx&#x27;</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">targetImage</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">targetImage</span> = targetImage</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setSrc</span>(<span class="params">targetUrl</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">targetImage</span>.<span class="title function_">setSrc</span>(<span class="title class_">ProxyImage</span>.<span class="property">LOADING_URL</span>) <span class="comment">// 真实Image初始化显示占位图片</span></span><br><span class="line">        <span class="keyword">const</span> virtualImage = <span class="keyword">new</span> <span class="title class_">Image</span>() <span class="comment">// 创建虚拟Image实例</span></span><br><span class="line">        virtualImage.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123; <span class="comment">// 虚拟Image加载完毕，真实Image显示真实图片</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">targetImage</span>.<span class="title function_">setSrc</span>(targetUrl)</span><br><span class="line">        &#125;</span><br><span class="line">        virtualImage.<span class="property">src</span> = targetUrl <span class="comment">// 虚拟Image初始化显示真实图片</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="缓存代理"><a href="#缓存代理" class="headerlink" title="缓存代理"></a>缓存代理</h3><p>&ensp;<strong>对运算结果进行缓存</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未代理，每次都重新计算</span></span><br><span class="line"><span class="keyword">const</span> addAll = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> len = <span class="variable language_">arguments</span>.<span class="property">length</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        result += <span class="variable language_">arguments</span>[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理，优先从缓存中读取计算结果</span></span><br><span class="line"><span class="keyword">const</span> proxyAddAll = (<span class="keyword">function</span>(<span class="params"></span>)&#123;                     </span><br><span class="line">    <span class="keyword">const</span> resultCache = &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">join</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span>(args <span class="keyword">in</span> resultCache) &#123;</span><br><span class="line">            <span class="keyword">return</span> resultCache[args]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultCache[args] = <span class="title function_">addAll</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="title function_">proxyAddAll</span>(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="保护代理"><a href="#保护代理" class="headerlink" title="保护代理"></a>保护代理</h3><p>&ensp;<strong>在访问层的getter和setter函数里添加校验和拦截，确保一部分变量是安全的</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">    <span class="attr">career</span>: <span class="string">&#x27;teacher&#x27;</span>,</span><br><span class="line">    <span class="attr">phone</span>: <span class="number">12345654321</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> baseInfo = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;career&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> privateInfo = [<span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> user = &#123;<span class="attr">isValidated</span>: <span class="literal">true</span>, <span class="attr">isVIP</span>: <span class="literal">false</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> accessProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(person, &#123;</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">person, key</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!user.<span class="property">isValidated</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;您还没有完成验证哦&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(!user.<span class="property">isVIP</span> &amp;&amp; privateInfo.<span class="title function_">indexOf</span>(key)!==-<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;只有VIP才可以查看该信息哦&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> person[key]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="行为型：策略模式-——-重构小能手，拆分胖逻辑"><a href="#行为型：策略模式-——-重构小能手，拆分胖逻辑" class="headerlink" title="行为型：策略模式 —— 重构小能手，拆分胖逻辑"></a>行为型：策略模式 —— 重构小能手，拆分胖逻辑</h2><p>&ensp;<strong>定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象映射：把相关算法收敛到一个对象里 </span></span><br><span class="line"><span class="comment">// 单一职责原则：各行为函数相互独立，不依赖调用主体</span></span><br><span class="line"><span class="keyword">const</span> priceProcessor = &#123;</span><br><span class="line">    <span class="title function_">processor1</span>(<span class="params">originPrice</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (originPrice &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> originPrice - <span class="number">20</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> originPrice * <span class="number">0.9</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">processor2</span>(<span class="params">originPrice</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (originPrice &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> originPrice - <span class="number">30</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> originPrice * <span class="number">0.8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过委托实现行为分发</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">askPrice</span>(<span class="params">tag, originPrice</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> priceProcessor[tag](originPrice)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展：开发封闭原则</span></span><br><span class="line">priceProcessor.<span class="property">processor3</span> = <span class="keyword">function</span>(<span class="params">originPrice</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (originPrice &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> originPrice - <span class="number">50</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> originPrice</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">askPrice</span>(<span class="string">&#x27;processor3&#x27;</span>, <span class="number">150</span>) <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>

<h2 id="行为型：状态模式-——-自主咖啡机背后的力量"><a href="#行为型：状态模式-——-自主咖啡机背后的力量" class="headerlink" title="行为型：状态模式 —— 自主咖啡机背后的力量"></a>行为型：状态模式 —— 自主咖啡机背后的力量</h2><p>&ensp;<strong>允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeMaker</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&#x27;init&#x27;</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">excessMile</span> = <span class="string">&#x27;1000ml&#x27;</span> <span class="comment">// 主体状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 单一职责原则：各行为函数可能不会特别割裂，和状态主体之间存在着关联</span></span><br><span class="line">    stateToProcess = &#123;</span><br><span class="line">        <span class="attr">that</span>: <span class="variable language_">this</span>,</span><br><span class="line">        <span class="title function_">american</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;咖啡机现在的牛奶存储量是:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">that</span>.<span class="property">leftMilk</span>) <span class="comment">// 获取主体状态</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;我只吐黑咖啡&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">latte</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">american</span>()</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加点奶&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">mocha</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">latte</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加点巧克力&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">changeState</span>(<span class="params">state</span>) &#123; <span class="comment">// 状态切换函数</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = state</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">stateToProcessor</span>[state]) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">stateToProcessor</span>[state]()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mk = <span class="keyword">new</span> <span class="title class_">CoffeeMaker</span>();</span><br><span class="line">mk.<span class="title function_">changeState</span>(<span class="string">&#x27;latte&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="行为型：观察者模式-——-鬼故事：产品经理拉了一个钉钉群"><a href="#行为型：观察者模式-——-鬼故事：产品经理拉了一个钉钉群" class="headerlink" title="行为型：观察者模式 —— 鬼故事：产品经理拉了一个钉钉群"></a>行为型：观察者模式 —— 鬼故事：产品经理拉了一个钉钉群</h2><p>&ensp;<strong>观察者模式定义了一种一对多的依赖关系，让多个观察者对象同时监听某一个目标对象，当这个目标对象的状态发生变化时，会通知所有观察者对象，使它们能够自动更新，发布者可以直接触及到订阅者</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ------ 角色划分 状态变化 发布者通知订阅者 ------ */</span></span><br><span class="line"><span class="comment">// 抽象的发布者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span> = [] <span class="comment">// *维护订阅者的集合</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Publisher created&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addObserver</span>(<span class="params">observer</span>) &#123; <span class="comment">// 增加订阅者</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Publisher.addObserver invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(observer)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">removeObserver</span>(<span class="params">observer</span>) &#123; <span class="comment">// 移除订阅者</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Publisher.removeObserver invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item === observer) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">splice</span>(i, <span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">notifyObserver</span>(<span class="params"></span>) &#123; <span class="comment">// 通知所有订阅者</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Publisher.notifyObserver invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">            observer.<span class="title function_">update</span>(<span class="variable language_">this</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象的订阅者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Observer created&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Observer.update invoked&#x27;</span>) <span class="comment">// *提供统一方法供发布者调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的发布者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpPublisher</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Publisher</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="literal">null</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpPublisher created&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpPublisher.getState invoked&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpPublisher.setState invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = state</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notifyObserver</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的订阅者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpObserver</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Observer</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="literal">null</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpObserver created&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params">publisher</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpObserver.update invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = publisher.<span class="title function_">getState</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">do</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">do</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;SpObserver.do invoked&#x27;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> publisher = <span class="keyword">new</span> <span class="title class_">SpPublisher</span>()</span><br><span class="line"><span class="keyword">const</span> observer1 = <span class="keyword">new</span> <span class="title class_">SpObserver</span>()</span><br><span class="line"><span class="keyword">const</span> observer2 = <span class="keyword">new</span> <span class="title class_">SpObserver</span>()</span><br><span class="line">publisher.<span class="title function_">addObserver</span>(observer1)</span><br><span class="line">publisher.<span class="title function_">addObserver</span>(observer2)</span><br><span class="line">publisher.<span class="title function_">setState</span>(<span class="string">&#x27;go!!!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="行为型：观察者模式-——-面试真题手把手教学"><a href="#行为型：观察者模式-——-面试真题手把手教学" class="headerlink" title="行为型：观察者模式 —— 面试真题手把手教学"></a>行为型：观察者模式 —— 面试真题手把手教学</h2><h3 id="Vue数据双向绑定（响应式系统）的实现原理"><a href="#Vue数据双向绑定（响应式系统）的实现原理" class="headerlink" title="Vue数据双向绑定（响应式系统）的实现原理"></a>Vue数据双向绑定（响应式系统）的实现原理</h3><p>&ensp;<strong>“发布-订阅”模式：发布者不直接触及到订阅者，而是由统一的第三方完成实际的通信操作,实现了完全地解耦</strong>  </p>
<ol>
<li>三个关键角色：监听器、订阅者、编译器<br>(1) observer监听器：监听数据并转发给订阅者（发布者）<br>(2) watcher订阅者：接收数据并更新视图<br>(3) compile编译器：初始化视图，更新订阅者…</li>
<li>核心代码<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// observer：在init阶段，对数据进行响应式化</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observer</span>(<span class="params">target</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(target &amp;&amp; <span class="keyword">typeof</span> target === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(target).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">defineReactive</span>(target, key, target[key])      </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">target, key, val</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>()</span><br><span class="line">    <span class="title function_">observer</span>(val)</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>) <span class="comment">// 依赖收集：将watcher对象存放到dep中</span></span><br><span class="line">            <span class="keyword">return</span> val</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123; <span class="comment">// 通过setter -&gt; Watcher -&gt; update的流程来修改视图</span></span><br><span class="line">            <span class="keyword">if</span>(val !== value) &#123;</span><br><span class="line">                val = value</span><br><span class="line">                dep.<span class="title function_">notify</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Dep：订阅者收集器（发布者）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span> = [] <span class="comment">//存放watcher</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(sub)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sub</span>)=&gt;</span>&#123;</span><br><span class="line">            sub.<span class="title function_">update</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// watcher: 订阅者（观察者)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视图更新啦～&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue data</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_data</span> = options.<span class="property">data</span></span><br><span class="line">        <span class="title function_">observer</span>(<span class="variable language_">this</span>.<span class="property">_data</span>)</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Watcher</span>()</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;render:&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_data</span>.<span class="property">test</span>) <span class="comment">// 模拟渲染，触发get</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123; <span class="attr">test</span>: <span class="number">1</span> &#125;</span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">_data</span>.<span class="property">test</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局事件总线 Event Bus：所有事件的发布/订阅操作必须经由事件中心</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">handlers</span> = &#123;&#125; <span class="comment">// 存储事件与回调的对应关系</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">on</span>(<span class="params">eventName, callback</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">handlers</span>[eventName]) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">handlers</span>[eventName] = [] <span class="comment">// 初始化监听函数队列</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">handlers</span>[eventName].<span class="title function_">push</span>(callback)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="params">eventName, ...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">handlers</span>[eventName]) &#123;</span><br><span class="line">            <span class="keyword">const</span> handlers = <span class="variable language_">this</span>.<span class="property">handlers</span>[eventName].<span class="title function_">slice</span>() <span class="comment">// 浅拷贝，避免once移除监听器时弄乱顺序</span></span><br><span class="line">            handlers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">callback</span>) =&gt;</span> &#123; <span class="comment">// 逐个调用监听函数队列里的回调函数</span></span><br><span class="line">                <span class="title function_">callback</span>(...args)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">/* this.handlers[eventName].forEach((callback) =&gt; &#123;</span></span><br><span class="line"><span class="comment">                callback(...args)</span></span><br><span class="line"><span class="comment">            &#125;) */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">off</span>(<span class="params">eventName, callback</span>) &#123; <span class="comment">// 移除监听函数队列里的指定回调函数</span></span><br><span class="line">        <span class="keyword">const</span> callbacks = <span class="variable language_">this</span>.<span class="property">handlers</span>[eventName]</span><br><span class="line">        <span class="keyword">const</span> index = callbacks.<span class="title function_">indexOf</span>(callback)</span><br><span class="line">        <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">            callbacks.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">once</span>(<span class="params">eventName, callback</span>) &#123; <span class="comment">// 单次监听</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">wrapper</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">            <span class="title function_">callback</span>(...args)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">off</span>(eventName, wrapper)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on</span>(eventName, wrapper)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bus = <span class="keyword">new</span> <span class="title class_">EventBus</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getNum</span>(<span class="params">num</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get:&#x27;</span>, num)</span><br><span class="line">&#125;</span><br><span class="line">bus.<span class="title function_">on</span>(<span class="string">&#x27;event1&#x27;</span>, getNum)</span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&#x27;event1&#x27;</span>, <span class="number">8</span>)</span><br><span class="line">bus.<span class="title function_">once</span>(<span class="string">&#x27;event2&#x27;</span>, getNum)</span><br><span class="line">bus.<span class="title function_">emit</span>(<span class="string">&#x27;event2&#x27;</span>, <span class="number">10</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="行为型：迭代器模式-——-真·遍历专家"><a href="#行为型：迭代器模式-——-真·遍历专家" class="headerlink" title="行为型：迭代器模式 —— 真·遍历专家"></a>行为型：迭代器模式 —— 真·遍历专家</h2><p>&ensp;<strong>迭代器模式提供一种方法顺序访问一个聚合对象中的各个元素，而又不暴露该对象的内部表示</strong></p>
<h3 id="ES6对迭代器的实现"><a href="#ES6对迭代器的实现" class="headerlink" title="ES6对迭代器的实现"></a>ES6对迭代器的实现</h3><p>&ensp;<strong>ES6约定，任何数据结构只要具备Symbol.iterator属性，就可以通过迭代器.next()和for(…of…)进行遍历</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment">// 迭代器.next()</span></span><br><span class="line"><span class="keyword">const</span> iterator = arr[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]()</span><br><span class="line"><span class="keyword">let</span> now = &#123; <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line"><span class="keyword">while</span>(!now.<span class="property">done</span>) &#123;</span><br><span class="line">    now = iterator.<span class="title function_">next</span>()</span><br><span class="line">    <span class="keyword">if</span>(!now.<span class="property">done</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`现在遍历到了<span class="subst">$&#123;now.value&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for(...of...)</span></span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">of</span> arr) &#123; <span class="comment">// 实际是next方法的反复调用</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`当前元素是<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现一个迭代器生成函数"><a href="#实现一个迭代器生成函数" class="headerlink" title="实现一个迭代器生成函数"></a>实现一个迭代器生成函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过闭包记录每次遍历的位置</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">iteratorGenerator</span>(<span class="params">list</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> len = list.<span class="property">length</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> done = idx &gt;= len</span><br><span class="line">            <span class="keyword">var</span> value = !done ? list[idx++] : <span class="literal">undefined</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">done</span>: done,</span><br><span class="line">                <span class="attr">value</span>: value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903842035793928">vue.use()方法从源码到使用</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_14993375/article/details/103981954">vuex 实现原理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/sllyli/vuejs/1244018">响应式系统的基本原理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/sllyli/vuejs/1244019">响应式系统的依赖收集追踪原理</a></li>
</ol>

    </div>
    
    <div class="post-footer">
        <div>
            
                转载声明：<br/>
                商业转载请联系作者获得授权, 非商业转载请注明出处 © XinAnXiaoZhan
                
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/ad2c1b4b.html" class="pre-post btn btn-default" title='javascript深浅拷贝'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            javascript深浅拷贝</span>
    </a>
    
    
    <a href="/a519f8f.html" class="next-post btn btn-default" title='deepmerge源码解析'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            deepmerge源码解析</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    
    
<div id="vcomments" class="valine"></div>

<script src="//unpkg.com/leancloud-storage@4.12.2/dist/av-live-query-min.js"></script>
<script src="/assets/valine.min.js"></script>

<script>
    new Valine({
        av: AV,
        el: '#vcomments',
        appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
        appKey: 'erIpQac4azoCmgfBB7Dl9maa',
        placeholder: '说点什么吧',
        notify: 'true',
        verify: 'true',
        avatar: 'mm',
        meta: 'nick,mail'.split(','),
        pageSize: '10',
        path: window.location.pathname,
        lang: 'zh-CN'.toLowerCase()
    })
    </script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-3">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E7%AF%87%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E6%88%90%E9%95%BF%E8%AE%BA"><span class="toc-text">开篇：前端工程师的成长论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E6%A0%B8%E5%BF%83%E7%AB%9E%E4%BA%89%E5%8A%9B"><span class="toc-text">一. 软件工程师的核心竞争力</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E2%80%9C%E9%81%93%E2%80%9D%E4%B8%8E%E2%80%9C%E6%9C%AF%E2%80%9D"><span class="toc-text">设计模式的“道”与“术”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%8C%87%E5%AF%BC%E7%90%86%E8%AE%BA"><span class="toc-text">一. 设计模式的指导理论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="toc-text">二. 设计模式的核心思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-23-%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">三. 23 种设计模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%EF%BC%9A%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E5%8C%BA%E5%88%86%E2%80%9C%E5%8F%98%E4%B8%8E%E4%B8%8D%E5%8F%98%E2%80%9D"><span class="toc-text">创建型：工厂模式 —— 区分“变与不变”</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E6%9E%84%E9%80%A0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">一. 构造器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">二. 简单工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">三. 抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%EF%BC%9A%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-Vuex-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%93%B2%E5%AD%A6"><span class="toc-text">创建型：单例模式 —— Vuex 的数据管理哲学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">一. 单例模式的实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%EF%BC%9AVuex-%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">二. 生产实践：Vuex 中的单例模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%EF%BC%9A%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E8%B0%88-Prototype-%E6%97%A0%E5%B0%8F%E4%BA%8B"><span class="toc-text">创建型：原型模式 —— 谈 Prototype 无小事</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E4%BB%A5%E7%B1%BB%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E8%AF%AD%E8%A8%80%E5%92%8C%E4%BB%A5%E5%8E%9F%E5%9E%8B%E4%B8%BA%E4%B8%AD%E5%BF%83%E7%9A%84%E8%AF%AD%E8%A8%80"><span class="toc-text">一. 以类为中心的语言和以原型为中心的语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E8%B0%88%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%85%B6%E5%AE%9E%E6%98%AF%E8%B0%88%E5%8E%9F%E5%9E%8B%E8%8C%83%E5%BC%8F"><span class="toc-text">二. 谈原型模式，其实是谈原型范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8E%9F%E5%9E%8B"><span class="toc-text">1. 原型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%B7%B1%E6%8B%B7%E8%B4%9D"><span class="toc-text">对象的深拷贝</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%EF%BC%9A%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E5%AF%B9%E8%B1%A1%E8%A3%85%E4%B8%8A%E5%AE%83%EF%BC%8C%E5%B0%B1%E5%83%8F%E5%BC%80%E4%BA%86%E6%8C%82"><span class="toc-text">结构型：装饰器模式 —— 对象装上它，就像开了挂</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%88%9D%E7%9B%B8%E8%A7%81"><span class="toc-text">装饰器模式初相见</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E5%BE%97%E5%85%B3%E6%B3%A8%E7%9A%84%E7%BB%86%E8%8A%82"><span class="toc-text">值得关注的细节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%EF%BC%9A%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E6%B7%B1%E5%85%A5%E8%A3%85%E9%A5%B0%E5%99%A8%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BC%98%E7%A7%80%E6%A1%88%E4%BE%8B"><span class="toc-text">结构型：装饰器模式 —— 深入装饰器原理与优秀案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%EF%BC%9AES7%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">前置知识：ES7中的装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AF%AD%E6%B3%95%E7%B3%96%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B"><span class="toc-text">装饰器语法糖背后的故事</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5"><span class="toc-text">生产实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#React%E4%B8%AD%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8%EF%BC%9AHOC"><span class="toc-text">React中的装饰器：HOC</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%EF%BC%9A%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E5%85%BC%E5%AE%B9%E4%BB%A3%E7%A0%81%E5%B0%B1%E6%98%AF%E4%B8%80%E6%8A%8A%E6%A2%AD"><span class="toc-text">结构型：适配器模式 —— 兼容代码就是一把梭</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E7%9A%84%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF"><span class="toc-text">适配器的业务场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%EF%BC%9Aaxios%E4%B8%AD%E7%9A%84%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text">生产实践：axios中的适配器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%EF%BC%9A%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5%E8%8C%83%E4%BE%8B%E8%A7%A3%E6%9E%90"><span class="toc-text">结构型：代理模式 —— 应用实践范例解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-ES6%E4%B8%AD%E7%9A%84Proxy"><span class="toc-text">前置知识 ES6中的Proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86"><span class="toc-text">事件代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E4%BB%A3%E7%90%86"><span class="toc-text">虚拟代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E4%BB%A3%E7%90%86"><span class="toc-text">缓存代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E4%BB%A3%E7%90%86"><span class="toc-text">保护代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%EF%BC%9A%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E9%87%8D%E6%9E%84%E5%B0%8F%E8%83%BD%E6%89%8B%EF%BC%8C%E6%8B%86%E5%88%86%E8%83%96%E9%80%BB%E8%BE%91"><span class="toc-text">行为型：策略模式 —— 重构小能手，拆分胖逻辑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%EF%BC%9A%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E8%87%AA%E4%B8%BB%E5%92%96%E5%95%A1%E6%9C%BA%E8%83%8C%E5%90%8E%E7%9A%84%E5%8A%9B%E9%87%8F"><span class="toc-text">行为型：状态模式 —— 自主咖啡机背后的力量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%EF%BC%9A%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E9%AC%BC%E6%95%85%E4%BA%8B%EF%BC%9A%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86%E6%8B%89%E4%BA%86%E4%B8%80%E4%B8%AA%E9%92%89%E9%92%89%E7%BE%A4"><span class="toc-text">行为型：观察者模式 —— 鬼故事：产品经理拉了一个钉钉群</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%EF%BC%9A%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E9%9D%A2%E8%AF%95%E7%9C%9F%E9%A2%98%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E5%AD%A6"><span class="toc-text">行为型：观察者模式 —— 面试真题手把手教学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%EF%BC%88%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">Vue数据双向绑定（响应式系统）的实现原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%EF%BC%9A%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F-%E2%80%94%E2%80%94-%E7%9C%9F%C2%B7%E9%81%8D%E5%8E%86%E4%B8%93%E5%AE%B6"><span class="toc-text">行为型：迭代器模式 —— 真·遍历专家</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ES6%E5%AF%B9%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">ES6对迭代器的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0"><span class="toc-text">实现一个迭代器生成函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-text">参考链接</span></a></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    <!-- 
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
     -->
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2021
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>